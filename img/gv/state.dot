/* $ dot -Tsvg state.dot -o state.svg */

digraph finite_state_machine {
	size="8,5"
	node [shape = doublecircle]; IDLE;
	node [shape = box];
	IDLE -> WAIT_STRIKE [ label = "Start" ];
	WAIT_STRIKE -> STRIKE [ label = "time>=Sd" ];
	STRIKE -> STRIKE_ALARM [ label = "temp>=St" ];
	STRIKE -> IDLE [ label = "time>=ASd"];
	STRIKE_ALARM -> STRIKE_PAUSE [ label = "button press" ];
	STRIKE_ALARM -> IDLE [ label = "time>=ASd" ];
	STRIKE_PAUSE -> MASH_STEP_INIT [ label = "quit button press" ];
	MASH_STEP_INIT -> MASH_STEP [ label = "temp>=setpoint" ];
	MASH_STEP_INIT -> IDLE [ label = "time>=ASd" ];
	MASH_STEP -> MASH_STEP_INIT [ label = "x<=4 and\ntime>=Pdx" ];
	MASH_STEP -> BOIL_UP_ALARM [ label = "x>4" ];
	BOIL_UP_ALARM -> BOIL_UP_PAUSE [ label = "button press" ];
	BOIL_UP_ALARM -> IDLE [ label = "time>=ASd" ];
	BOIL_UP_PAUSE -> BOIL_UP [ label = "quit button press" ];
	BOIL_UP -> HOTBREAK [ label = "temp>=Ht" ];
	BOIL_UP -> IDLE [ label = "time>=ASd" ];
	HOTBREAK -> BOIL [ label = "time>=Hd" ];
	BOIL -> HOPALARM [ label = "time==hdx"];
	HOPALARM -> BOIL;
	BOIL -> IDLE [ label = "time>=bd" ];

	IDLE [ label = "Idle" ];
	WAIT_STRIKE [ label = "Wait to heat strike water\nOutput=0\nPump off" ];
	STRIKE [ label = "Heat strike water\noutput=SO\nPump on" ];
	STRIKE_ALARM [ label = "Strike Alarm" ];
	STRIKE_PAUSE [ label = "Pause\n(Add grains)\nx=1" ];
	MASH_STEP_INIT [ label = "Init mash step x\nsetpoint=Ptx\noutput=PO\nPump on" ];
	MASH_STEP [ label = "Mash step\nx=x+1"];
	BOIL_UP_ALARM [ label = "Boil up Alarm" ];
	BOIL_UP_PAUSE [ label = "Pause\n(Remove grains/sparge)" ];
	BOIL_UP [ label = "Boil up\noutput=SO\nPump off" ];
	HOTBREAK [ label = "Wait for hotbreak\noutput=hO" ];
	BOIL [ label = "Boil\noutput=bO" ];
	HOPALARM [ label = "Hop addition alarm" ];

}

